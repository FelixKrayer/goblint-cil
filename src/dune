(include_subdirs unqualified)

(library
  (public_name goblint-cil)
  (name cil)
  (wrapped false) ; this should be changed, but then module paths in goblint need to be prefixed
  (libraries zarith findlib dynlink unix str)
)

(rule
  (targets machdep.ml cilversion.ml)
  (deps ../configure.ac ../Makefile.in ../install-sh ../config.sub ../config.guess ../config.h.in ../stamp-h.in cil.mli machdep-ml.c.in cilversion.ml.in)
  (action (chdir .. (progn (run ./configure) (run make machdep) (run cp _build/machdep.ml src))))
)

(ocamllex formatlex)
(ocamlyacc formatparse)

; (executable
;   (libraries cil)
;   (public_name main)
; )

(env
  (dev
    (flags (:standard -warn-error -A)) ; https://dune.readthedocs.io/en/stable/faq.html#how-to-make-warnings-non-fatal
  )
)
